/*!
 * Knockout Siteengine
 * @version v0.1
 * @link https://github.com/low-res/ko-siteengine
 * @author we.byte GmbH - http://www.webyte.org
 */

define("router",["knockout","crossroads","hasher","signals"],function(e,t,n,s){function r(){{var t=this;this.currentRoute=e.observable({})}this.initalHash=null,this.currentHash=null,this.routes=[],this.routeChanged=new s.Signal,this.currentRouteIdx=e.computed(function(){var e=t.routes.indexOf(t.currentRoute());return e})}var i=r.prototype;return i.setRoutes=function(e){this.routes=e,this._initRoutes(e),this._activateCrossroads(),n.setHash(this.routes[0].url)},i.gotoRoute=function(e){var t=this.routes.indexOf(e);t>-1&&n.setHash(this.routes[t].url)},i.gotoPage=function(e){n.setHash(this.routes[e].url)},i.nextPage=function(){n.setHash(this._getNextPageHash())},i.prevPage=function(){n.setHash(this._getPrevPageHash())},i._getNextPageHash=function(){var e=this.routes.indexOf(this.currentRoute()),t=this.routes[e];return this.routes.length>e+1&&(t=this.routes[e+1]),t.url},i._getPrevPageHash=function(){var e=this.routes.indexOf(this.currentRoute()),t=this.routes[e];return e>0&&(t=this.routes[e-1]),t.url},i._initRoutes=function(n){var s=this;e.utils.arrayForEach(n,function(n){t.addRoute(n.url,function(t){var r=e.utils.extend(t,n.params);s.currentRoute(n),s.routeChanged.dispatch(r,n.url)})})},i._activateCrossroads=function(){function e(e,n){r.currentHash=e,t.parse(e)}function s(e,n){r.initalHash=e,t.parse(e)}var r=this;t.normalizeFn=t.NORM_AS_OBJECT,n.initialized.add(s),n.changed.add(e),n.init()},new r}),define("preloader",["amplify","jquery","preloadjs"],function(e,t){var n=function(t){switch(t.type){case"fileload":e.publish("preloader.fileload");break;case"error":e.publish("preloader.error");break;case"progress":e.publish("preloader.progress",{percentLoaded:100*t.progress})}};return{preloadAssetsManifest:function(s){e.publish("preloader.start");var r=t.Deferred(),i=new createjs.LoadQueue(!0);return i.on("fileload",n,this),i.on("fileprogress",n,this),i.on("error",n,this),i.on("progress",n,this),i.on("complete",function(){r.resolve(i),e.publish("preloader.complete",{assets:i})}),i.loadManifest(s),r.promise()}}}),define("defaultPageTransitionStrategy",["knockout","jquery","velocity","preloader"],function(e,t,n,s){function r(e){this.pageComponentDefinition=e,this.currentPageVmInstance=null,this.componentNameNewPage=null,this.newPageVmInstance=null,this.newPageUrl="",this.pageViewModels={}}var i=r.prototype;return i.handlePageChange=function(t,n){var s=this,r=t.page;this.newPageUrl=n,this.pageViewModels[n]?(this.newPageVmInstance=this.pageViewModels[n],this.componentNameNewPage=r,this._doPageTransition()):e.components.isRegistered(r)?s._processPageChange(r):s._dummyTransition(r)},i._processPageChange=function(t){var n=this;e.components.get(t,function(e){if(e.createViewModel){var s=e.createViewModel({});n.newPageVmInstance=s,n.componentNameNewPage=t,n.pageViewModels[n.newPageUrl]=s,n._doPageTransition()}else n._dummyTransition(t)})},i._doPageTransition=function(){this.hideAnimation().then(t.proxy(this.appendNewPage,this)).then(t.proxy(this.preloadAssets,this)).then(t.proxy(this.applyLoadedAssets,this)).then(t.proxy(this.showAnimation,this))},i.hideAnimation=function(){var e=this.currentPageVmInstance,n=t.Deferred().resolve().promise();return e&&e.hideAnimation&&(n=e.hideAnimation()),n},i.appendNewPage=function(){var e={name:this.componentNameNewPage,params:{instance:this.newPageVmInstance}};this.currentPageVmInstance=this.newPageVmInstance,this.newPageVmInstance=null,this.pageComponentDefinition(e);var n=t.Deferred();return setTimeout(function(){n.resolve()},100),n.promise()},i.preloadAssets=function(){var e=this.currentPageVmInstance;return e.getPreloadAssetsManifest&&e.getPreloadAssetsManifest().length>0?s.preloadAssetsManifest(e.getPreloadAssetsManifest()):t.Deferred().resolve().promise()},i.applyLoadedAssets=function(e){var n=t.Deferred().resolve().promise(),s=this.currentPageVmInstance;return s.applyLoadedAssets&&(n=s.applyLoadedAssets(e)),n},i.showAnimation=function(){var e=t.Deferred().resolve().promise(),n=this.currentPageVmInstance;return n.showAnimation&&(e=n.showAnimation()),e},i._dummyTransition=function(e){var t={name:e,params:{}};this.pageComponentDefinition(t)},r}),define("pageManager",["knockout","router","defaultPageTransitionStrategy"],function(e,t,n){function s(){this.route=t.currentRoute,this.routeIdx=t.currentRouteIdx,this.currentPage=e.observable({}),this.pageTransition=new n(this.currentPage),t.routeChanged.add(this.handlePageChange,this)}var r=s.prototype;return r.init=function(e){t.setRoutes(e)},r.handlePageChange=function(e,t){this.pageTransition.handlePageChange(e,t)},s}),require(["pageManager"]),require.config({bundles:{}});